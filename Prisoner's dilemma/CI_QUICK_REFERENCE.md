# 置信区间快速参考 (CI Quick Reference Card)

## 核心公式

```
95% CI = mean ± 1.96 × (stdev / √n)
```

## 计算步骤

1. **均值**: `mean = Σscores / n`
2. **方差**: `var = Σ(score - mean)² / (n-1)`
3. **标准差**: `stdev = √var`
4. **标准误差**: `SE = stdev / √n`
5. **误差边界**: `Margin = 1.96 × SE`
6. **置信区间**: `[mean - Margin, mean + Margin]`

## 输出格式

```
策略名: mean [ci_lower, ci_upper] (σ=stdev)

示例:
TFT: 285.40 [282.15, 288.65] (σ=23.20)
```

## 解读规则

| CI关系 | 含义 | 显著性 |
|--------|------|--------|
| 完全分离 | 差异明显 | p < 0.001 |
| 不重叠 | 差异显著 | p < 0.05 |
| 部分重叠 | 可能有差异 | 需检验 |
| 完全重叠 | 无显著差异 | p > 0.05 |

## CI宽度指南

| 宽度 | 重复次数 | 精度 | 适用场景 |
|------|---------|------|---------|
| ±5   | 30-40   | 低   | 快速测试 |
| ±3   | 50-75   | 中等 | 标准实验 |
| ±2   | 100+    | 高   | 精确测量 |

## 重复次数选择

```
n = 30:  SE ∝ 1/√30  ≈ 0.183  (最小推荐)
n = 50:  SE ∝ 1/√50  ≈ 0.141  (标准选择) ✓
n = 100: SE ∝ 1/√100 = 0.100  (高精度)
```

## 影响因素

### 1. 样本量 (n)
- ↑ n → ↓ SE → ↓ CI宽度
- 加倍n → CI宽度减少29%

### 2. 标准差 (σ)
- ↑ σ → ↑ SE → ↑ CI宽度
- 噪声增加 → σ增加 → CI变宽

### 3. 置信水平
- 90% CI: z = 1.645 (窄)
- 95% CI: z = 1.96 (标准) ✓
- 99% CI: z = 2.576 (宽)

## 常见值表

### Z值速查

| 置信水平 | α | z值 |
|---------|---|-----|
| 90% | 0.10 | 1.645 |
| 95% | 0.05 | 1.96 |
| 99% | 0.01 | 2.576 |

### √n 速查

| n | √n | 1/√n |
|---|-----|------|
| 10 | 3.162 | 0.316 |
| 20 | 4.472 | 0.224 |
| 30 | 5.477 | 0.183 |
| 40 | 6.325 | 0.158 |
| 50 | 7.071 | 0.141 |
| 75 | 8.660 | 0.115 |
| 100 | 10.000 | 0.100 |

## 典型场景

### 场景1: 完全剥削
```
PROBER: 746.20 [745.78, 746.62] (σ=1.50)
ALLC:     5.90 [  5.68,   6.12] (σ=0.80)

✓ CI完全不重叠
✓ 差异极其显著 (p << 0.001)
```

### 场景2: 近似相等
```
TFT:    450.30 [447.15, 453.45] (σ=22.50)
PROBER: 448.60 [445.50, 451.70] (σ=22.10)

✓ CI显著重叠
✓ 无显著差异 (p > 0.05)
```

### 场景3: 噪声影响
```
ε=0.00: 285.40 [283.75, 286.25] (窄CI)
ε=0.10: 245.20 [240.04, 250.36] (宽CI)

✓ 性能下降显著
✓ 不确定性增加
```

## 报告模板

### 简洁版
```
Strategy: mean [CI_lower, CI_upper]
TFT: 285.40 [282.15, 288.65]
```

### 完整版
```
Strategy: mean [CI_lower, CI_upper] (σ=stdev, n=repeats)
TFT: 285.40 [282.15, 288.65] (σ=23.20, n=50)
```

### 学术版
```
Results are reported as mean [95% CI] based on n independent 
replications. TFT achieved a mean score of 285.40 [282.15, 288.65], 
significantly outperforming ALLC (245.60 [242.50, 248.70]), p < 0.001.
```

## 检查清单

实验前：
- [ ] 确定重复次数（建议≥50）
- [ ] 设置随机种子（可复现）
- [ ] 记录所有参数

实验中：
- [ ] 保存每次重复的得分
- [ ] 计算均值和标准差
- [ ] 应用CI公式

报告时：
- [ ] 显示mean和CI
- [ ] 包含标准差
- [ ] 说明重复次数
- [ ] 解释显著性

## 常见错误

❌ **只报告均值**
```
TFT: 285.40
```

✓ **正确报告**
```
TFT: 285.40 [282.15, 288.65]
```

❌ **使用总数分母**
```
var = Σ(x - mean)² / n  // 错误！
```

✓ **使用样本分母**
```
var = Σ(x - mean)² / (n-1)  // 正确！
```

❌ **混淆标准差和标准误差**
```
CI = mean ± 1.96 × stdev  // 错误！
```

✓ **使用标准误差**
```
CI = mean ± 1.96 × (stdev / √n)  // 正确！
```

## 程序使用

### 自动计算
```bash
# 程序自动计算并显示CI
"Prisoner's dilemma.exe" --rounds 150 --repeats 50 --strategies TFT PAVLOV
```

### 输出示例
```
=================================================
--- 锦标赛结果 (各策略平均分及95%置信区间) ---
=================================================

格式: 策略名称: 平均分 [95% CI 下限, 上限] (标准差)
基于 50 次重复实验

1. TFT    : 285.40  [282.15, 288.65]  (σ=23.20)
2. PAVLOV : 276.80  [273.50, 280.10]  (σ=23.60)
```

## 统计显著性

### 判断标准

```
如果 CI1_upper < CI2_lower:
    → Strategy2显著优于Strategy1 (p < 0.05)

如果 CI1和CI2重叠:
    → 需要进一步检验或增加样本量
```

### p值对应

| CI关系 | 近似p值 |
|--------|---------|
| 完全分离 | < 0.001 |
| 不重叠 | < 0.05 |
| 轻微重叠 | ≈ 0.05 |
| 显著重叠 | > 0.05 |

## 快速计算器

### 给定: n=50, σ=10

```
SE = 10 / √50 = 1.414
Margin = 1.96 × 1.414 = 2.771
CI宽度 = 2 × 2.771 = 5.542
```

### 给定: n=50, σ=20

```
SE = 20 / √50 = 2.828
Margin = 1.96 × 2.828 = 5.543
CI宽度 = 2 × 5.543 = 11.086
```

## 最佳实践

### DO ✓
- 使用至少50次重复
- 报告完整统计信息
- 检查CI重叠
- 解释结果含义
- 保存原始数据

### DON'T ❌
- 只报告均值
- 使用过少重复（<30）
- 忽略标准差
- 错误解读重叠
- 舍弃异常值

## 参考文献

### 统计方法
- 中心极限定理（n≥30）
- 样本方差（Bessel校正）
- 标准正态分布（z=1.96）

### 实现文件
- `Simulator.h` - 计算逻辑
- `SimulatorRunner.cpp` - 显示格式
- `CONFIDENCE_INTERVALS.md` - 详细说明

---

**版本**: 1.0
**置信水平**: 95%
**Z值**: 1.96
**推荐重复**: n ≥ 50
