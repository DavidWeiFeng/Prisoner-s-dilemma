# 置信区间计算示例 (Confidence Interval Examples)

## 示例 1: 手动计算步骤

假设我们运行了30次重复（RPT = 30），得到以下分数：

### 原始数据
```
重复次数: 30
回合数: 150
策略: TFT vs 所有对手

各次重复的总得分:
282, 285, 279, 290, 288, 283, 281, 287, 286, 284,
289, 280, 285, 283, 291, 282, 286, 288, 284, 287,
285, 283, 289, 281, 290, 286, 284, 288, 287, 285
```

### 步骤 1: 计算平均值 (Mean)

```
Sum = 282 + 285 + ... + 285 = 8550
Mean = Sum / n = 8550 / 30 = 285.0
```

### 步骤 2: 计算标准差 (Standard Deviation)

```
1. 计算每个值与均值的差的平方:
   (282 - 285)² = 9
   (285 - 285)² = 0
   (279 - 285)² = 36
   ... (继续所有30个值)

2. 求和所有平方差:
   Sum of squares = 1044

3. 计算样本方差 (除以 n-1):
   Variance = 1044 / (30 - 1) = 1044 / 29 = 36.0

4. 标准差是方差的平方根:
   StdDev = √36.0 = 6.0
```

### 步骤 3: 计算标准误差 (Standard Error)

```
SE = StdDev / √n
   = 6.0 / √30
   = 6.0 / 5.477
   = 1.095
```

### 步骤 4: 计算误差边界 (Margin of Error)

```
Margin = 1.96 × SE
       = 1.96 × 1.095
       = 2.146
```

### 步骤 5: 构建置信区间

```
Lower bound = Mean - Margin = 285.0 - 2.146 = 282.854
Upper bound = Mean + Margin = 285.0 + 2.146 = 287.146

四舍五入到两位小数:
95% CI = [282.85, 287.15]
```

### 最终报告

```
TFT: Mean = 285.00, 95% CI [282.85, 287.15]
```

**解释**: 基于30次重复，我们有95%的信心认为TFT的真实平均得分在282.85到287.15之间。

---

## 示例 2: 比较两个策略

### 场景: PROBER vs ALLC (无噪声)

```
配置:
- 回合数: 150
- 重复次数: 50
- 噪声: ε = 0.0
```

### PROBER 的得分

```
50次重复的总分:
745, 748, 743, 746, 747, 745, 749, 746, 744, 748,
747, 745, 746, 748, 747, 744, 746, 745, 747, 749,
746, 745, 748, 746, 747, 745, 746, 747, 748, 744,
746, 747, 745, 746, 748, 747, 745, 746, 744, 747,
746, 745, 748, 747, 746, 745, 747, 746, 748, 745

计算:
Mean = 746.20
StdDev = 1.50
SE = 1.50 / √50 = 0.212
Margin = 1.96 × 0.212 = 0.416

95% CI = [746.20 - 0.42, 746.20 + 0.42]
       = [745.78, 746.62]
```

### ALLC 的得分

```
50次重复的总分:
6, 5, 6, 7, 5, 6, 6, 5, 6, 7,
6, 5, 6, 7, 6, 5, 6, 6, 5, 7,
6, 5, 6, 7, 6, 5, 6, 6, 7, 5,
6, 6, 5, 7, 6, 5, 6, 6, 5, 7,
6, 5, 6, 7, 6, 5, 6, 6, 7, 5

计算:
Mean = 5.90
StdDev = 0.80
SE = 0.80 / √50 = 0.113
Margin = 1.96 × 0.113 = 0.221

95% CI = [5.90 - 0.22, 5.90 + 0.22]
       = [5.68, 6.12]
```

### 对比分析

```
PROBER: 746.20 [745.78, 746.62]
ALLC:     5.90 [  5.68,   6.12]

观察:
1. 置信区间完全不重叠
2. PROBER的下限 (745.78) > ALLC的上限 (6.12)
3. 差异极其显著 (p << 0.001)
4. 结论: PROBER完全剥削ALLC
```

---

## 示例 3: 噪声的影响

### 场景: TFT在不同噪声水平下

```
配置:
- 回合数: 150
- 重复次数: 50
```

### ε = 0.0 (无噪声)

```
Mean = 285.00
StdDev = 4.50
SE = 4.50 / √50 = 0.636
Margin = 1.96 × 0.636 = 1.247

95% CI = [283.75, 286.25]
CI宽度 = 2.494
```

### ε = 0.05 (5%噪声)

```
Mean = 268.50
StdDev = 12.30
SE = 12.30 / √50 = 1.739
Margin = 1.96 × 1.739 = 3.408

95% CI = [265.09, 271.91]
CI宽度 = 6.816
```

### ε = 0.10 (10%噪声)

```
Mean = 245.20
StdDev = 18.60
SE = 18.60 / √50 = 2.631
Margin = 1.96 × 2.631 = 5.157

95% CI = [240.04, 250.36]
CI宽度 = 10.314
```

### 分析

```
噪声水平  平均分  95% CI              CI宽度  性能下降
--------  ------  ------------------  ------  --------
ε = 0.00  285.00  [283.75, 286.25]    2.49    0%
ε = 0.05  268.50  [265.09, 271.91]    6.82    5.8%
ε = 0.10  245.20  [240.04, 250.36]    10.31   14.0%

观察:
1. 平均分随噪声增加而下降
2. CI宽度随噪声增加而增大（不确定性增加）
3. 标准差随噪声增加而增大（变异性增加）
4. 所有CI不重叠 → 每个噪声水平的影响显著
```

---

## 示例 4: 近似相等的策略

### 场景: TFT vs PAVLOV (无噪声)

```
配置:
- 回合数: 150
- 重复次数: 50
- 噪声: ε = 0.0
```

### TFT

```
Mean = 276.80
StdDev = 8.20
SE = 8.20 / √50 = 1.160
Margin = 1.96 × 1.160 = 2.274

95% CI = [274.53, 279.07]
```

### PAVLOV

```
Mean = 278.20
StdDev = 8.50
SE = 8.50 / √50 = 1.202
Margin = 1.96 × 1.202 = 2.356

95% CI = [275.84, 280.56]
```

### 对比

```
TFT:    276.80 [274.53, 279.07]
PAVLOV: 278.20 [275.84, 280.56]

观察:
1. 置信区间重叠 [275.84, 279.07]
2. PAVLOV的下限 < TFT的上限
3. 差异不显著 (p > 0.05)
4. 结论: 两者表现近似相等，需要更多数据来确定优劣
```

---

## 示例 5: 提高精度

### 如何缩小置信区间？

#### 当前情况
```
重复次数: n = 30
标准差: σ = 10.0
SE = 10.0 / √30 = 1.826
Margin = 1.96 × 1.826 = 3.579
CI宽度 = 2 × 3.579 = 7.158
```

#### 方案1: 增加重复次数到50
```
n = 50
SE = 10.0 / √50 = 1.414
Margin = 1.96 × 1.414 = 2.771
CI宽度 = 2 × 2.771 = 5.542

改善 = (7.158 - 5.542) / 7.158 = 22.6%
```

#### 方案2: 增加重复次数到100
```
n = 100
SE = 10.0 / √100 = 1.000
Margin = 1.96 × 1.000 = 1.960
CI宽度 = 2 × 1.960 = 3.920

改善 = (7.158 - 3.920) / 7.158 = 45.2%
```

#### 方案3: 降低噪声（减少标准差到5.0）
```
n = 30, σ = 5.0
SE = 5.0 / √30 = 0.913
Margin = 1.96 × 0.913 = 1.789
CI宽度 = 2 × 1.789 = 3.578

改善 = (7.158 - 3.578) / 7.158 = 50.0%
```

### 建议

| 目标CI宽度 | 建议重复次数 | 预期精度 |
|-----------|-------------|---------|
| 宽 (±5)   | 30-40       | 低      |
| 中 (±3)   | 50-75       | 中等    |
| 窄 (±2)   | 100+        | 高      |

---

## 示例 6: 实际程序输出

### 命令
```bash
"Prisoner's dilemma.exe" --rounds 150 --repeats 50 --epsilon 0.0 --strategies PROBER AllCooperate TitForTat
```

### 预期输出

```
=================================================
--- 锦标赛结果 (各策略平均分及95%置信区间) ---
=================================================

格式: 策略名称: 平均分 [95% CI 下限, 上限] (标准差)
基于 50 次重复实验

1. PROBER              : 498.60  [495.22, 501.98]  (σ=24.18)
2. TFT                 : 452.30  [449.15, 455.45]  (σ=22.50)
3. ALLC                : 301.20  [298.45, 303.95]  (σ=19.65)

说明:
  - 平均分: 该策略在所有对战中的平均得分
  - 95% CI: 95%置信区间，真实均值有95%概率落在此区间内
  - 标准差(σ): 得分的离散程度
  - 置信区间公式: mean ± 1.96 × (σ / √50)

--- 模拟结束 ---
```

### 解读

```
PROBER vs ALLC:
- PROBER成功剥削ALLC，得分远高于其他对战
- PROBER的CI不与TFT重叠 → 显著优于TFT
- ALLC的CI最低 → 被所有策略剥削

TFT:
- 与PROBER部分合作，与ALLC互惠
- CI较窄 → 表现稳定
- 标准差适中 → 对手多样性造成变化

ALLC:
- 最低分数
- CI不与其他策略重叠 → 显著弱于其他策略
- 标准差较小 → 总是被剥削，结果可预测
```

---

## 总结

### 关键公式
```
SE = σ / √n
Margin = 1.96 × SE
95% CI = [mean - Margin, mean + Margin]
```

### 判断规则
1. **CI不重叠** → 差异显著
2. **CI完全重叠** → 差异不显著
3. **CI部分重叠** → 需要更多数据或统计检验

### 最佳实践
1. 使用至少50次重复
2. 始终报告CI，不只是均值
3. 比较CI重叠情况
4. 解释结果的统计意义

---

**文档版本**: 1.0
**计算精度**: 2位小数
**统计显著性**: α = 0.05 (95% 置信水平)
